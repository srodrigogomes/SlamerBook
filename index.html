<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SlamerPath - Aventura em In√°ria</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel (para compilar JSX no navegador) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Anima√ß√µes personalizadas para simular o lucide-react e transi√ß√µes */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideIn { from { transform: translateX(20px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .animate-in { animation: fadeIn 0.5s ease-out forwards; }
        .slide-in-from-right { animation: slideIn 0.3s ease-out forwards; }
        
        /* Scrollbar personalizada sutil */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="bg-gray-100 h-screen w-screen overflow-hidden flex justify-center items-center">

    <div id="root" class="w-full h-full max-w-md bg-white shadow-2xl overflow-hidden relative"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ==========================================
        // --- √çCONES (Adaptados para HTML √önico) ---
        // ==========================================
        const IconBase = ({ children, color = "currentColor", size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const Icons = {
            Feather: (props) => <IconBase {...props}><path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"></path><line x1="16" y1="8" x2="2" y2="22"></line><line x1="17.5" y1="15" x2="9" y2="15"></line></IconBase>,
            User: (props) => <IconBase {...props}><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></IconBase>,
            Lock: (props) => <IconBase {...props}><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></IconBase>,
            ArrowLeft: (props) => <IconBase {...props}><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></IconBase>,
            Heart: (props) => <IconBase {...props}><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></IconBase>,
            Zap: (props) => <IconBase {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></IconBase>,
            Check: (props) => <IconBase {...props}><polyline points="20 6 9 17 4 12"></polyline></IconBase>,
            X: (props) => <IconBase {...props}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></IconBase>,
            Star: (props) => <IconBase {...props}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></IconBase>,
            Trophy: (props) => <IconBase {...props}><path d="M8 21h8"></path><path d="M12 17v4"></path><path d="M7 4h10"></path><path d="M17 4v6a5 5 0 0 1-10 0V4"></path><path d="M7 4H4a2 2 0 0 0-2 2v1a5 5 0 0 0 5 5"></path><path d="M17 4h3a2 2 0 0 1 2 2v1a5 5 0 0 1-5 5"></path></IconBase>,
            Home: (props) => <IconBase {...props}><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></IconBase>,
            Award: (props) => <IconBase {...props}><circle cx="12" cy="8" r="7"></circle><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline></IconBase>,
            Settings: (props) => <IconBase {...props}><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></IconBase>,
            MessageSquare: (props) => <IconBase {...props}><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></IconBase>,
            ChevronRight: (props) => <IconBase {...props}><polyline points="9 18 15 12 9 6"></polyline></IconBase>,
            Sun: (props) => <IconBase {...props}><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></IconBase>,
            Shield: (props) => <IconBase {...props}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></IconBase>,
            Sword: (props) => <IconBase {...props}><polyline points="14.5 17.5 3 6 3 3 6 3 17.5 14.5"></polyline><line x1="13" y1="19" x2="19" y2="13"></line><line x1="16" y1="16" x2="20" y2="20"></line><line x1="19" y1="21" x2="21" y2="19"></line></IconBase>,
            Flame: (props) => <IconBase {...props}><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.1.2-2.2.5-3 .5.3 1 .8 1.5 1.5z"></path></IconBase>,
            Ghost: (props) => <IconBase {...props}><path d="M9 22l5.5-1.5L20 22l-1.5-5.5A9 9 0 0 0 11.5 2L9 4.5 6 2 4.5 7.5A9 9 0 0 0 2 16.5L3.5 22 9 20.5z"></path><path d="M8 13a2 2 0 1 0 2-2 2 2 0 0 0-2 2z"></path><path d="M14 13a2 2 0 1 0 2-2 2 2 0 0 0-2 2z"></path></IconBase>,
            RefreshCw: (props) => <IconBase {...props}><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></IconBase>,
            HelpCircle: (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></IconBase>,
            FileText: (props) => <IconBase {...props}><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></IconBase>,
            Layers: (props) => <IconBase {...props}><polygon points="12 2 2 7 12 12 22 7 12 2"></polygon><polyline points="2 17 12 22 22 17"></polyline><polyline points="2 12 12 17 22 12"></polyline></IconBase>,
            UserPlus: (props) => <IconBase {...props}><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="8.5" cy="7" r="4"></circle><line x1="20" y1="8" x2="20" y2="14"></line><line x1="23" y1="11" x2="17" y2="11"></line></IconBase>
        };

        // ====================================================================
        // --- DADOS E L√ìGICA ---
        // ====================================================================

        const APP_NAME = "SlamerPath";

        const INITIAL_USERS = [
          { username: 'admin', password: '123', name: 'Rodrigo Gomes', email: 'autor@slamer.com', isAdmin: true },
          { username: 'peter', password: '123', name: 'Peter Richt', email: 'peter@inaira.com' }
        ];

        const MOCK_BOOKS = [
          { 
            id: 'slamer_book', 
            title: 'O Livro de Slamer', 
            author: 'Rodrigo Gomes', 
            progress: 0, 
            icon: Icons.Feather, 
            color: '#EAB308', 
            isStarter: true
          }
        ];

        const MAP_STRUCTURE = [
          { id: 'm1', title: 'Solcris: O Convite', phases: 1, gameType: 'Quiz', description: "O in√≠cio da jornada." }, 
          { id: 'm2', title: 'A Orla de Slamer', phases: 1, gameType: 'Memory', description: "Conhe√ßa seus aliados." },
          { id: 'm3', title: 'Lumin√≠rios & Den√≠sia', phases: 1, gameType: 'DragAndDrop', description: "Encontre os objetos de poder." },
          { id: 'm4', title: 'O Primeiro Encanto', phases: 1, gameType: 'SpellTyper', description: "Lance feiti√ßos contra as plantas!" },
          { id: 'm5', title: 'Krotons e Cruhell', phases: 1, gameType: 'Battle', description: "Batalha final contra as sombras." },
          { id: 'm6', title: 'Ep√≠logo: A P√°gina Rasgada', phases: 1, gameType: 'Unscramble', description: "Restaure a mensagem final." },
        ];

        const QUIZ_DATA = {
            question: "Qual o nome do fen√¥meno que transportou Peter e D√©bora para In√°ria?",
            options: ["Solcris", "Eclipse Lunar", "Tempestade Solar", "Buraco Negro"],
            correctAnswer: "Solcris",
            hint: "Ocorre quando o c√≠rculo de transporte √© ativado pela luz."
        };

        const DRAG_DATA = {
            pairs: [
              { id: 1, target: "√Åtila", description: "Guardi√£o" },
              { id: 2, target: "Slamer", description: "Criador do Livro" },
              { id: 3, target: "√ìrion", description: "Reino Sombrio" },
              { id: 4, target: "In√°ria", description: "Terra de Luz" },
            ],
            sources: [
                { id: 1, content: "Guardi√£o" },
                { id: 2, content: "Terra de Luz" },
                { id: 3, content: "Criador do Livro" },
                { id: 4, content: "Reino Sombrio" },
            ]
        };

        const MEMORY_CARDS = [
            { id: 1, icon: Icons.User, name: "Peter" },
            { id: 2, icon: Icons.Sun, name: "D√©bora" },
            { id: 3, icon: Icons.Shield, name: "Soltesner" },
            { id: 4, icon: Icons.Feather, name: "√Åria" },
            { id: 5, icon: Icons.Ghost, name: "Marley" },
            { id: 6, icon: Icons.Sword, name: "Slamer" },
        ];

        const SPELL_DATA = [
            { spell: "Susccipio", meaning: "A primeira palavra do livro." },
            { spell: "Inc√™ndio Illu Aere", meaning: "Fogo azul contra as plantas." },
            { spell: "Naturae Imperium", meaning: "Comando da natureza." }
        ];

        const BATTLE_DATA = {
            enemyName: "Cruhell",
            enemyMaxHp: 100,
            playerMaxHp: 100
        };

        const PUZZLE_DATA = {
            correctOrder: [
                "Quando fundi o livro",
                "ao meu corpo,",
                "ele se tornou",
                "parte de mim."
            ],
            scrambled: [
                { id: 'p3', text: "ele se tornou" },
                { id: 'p1', text: "Quando fundi o livro" },
                { id: 'p4', text: "parte de mim." },
                { id: 'p2', text: "ao meu corpo," },
            ]
        };

        const MOCK_RANKING = [
          { rank: 1, name: 'Mestre√Åtila', xp: 8200, isSelf: false },
          { rank: 2, name: 'Feiticeira√Åria', xp: 6850, isSelf: false },
          { rank: 3, name: 'Voc√™', xp: 1200, isSelf: true }, 
          { rank: 4, name: 'Soltesner', xp: 950, isSelf: false },
        ];

        const MOCK_ACHIEVEMENTS = [
          { id: 1, title: 'Bem-vindo a In√°ria', description: 'Complete o Cap√≠tulo Solcris.', completed: true, icon: Icons.Sun }, 
          { id: 2, title: 'Orla de Slamer', description: 'Desbloqueie todos os personagens.', completed: false, icon: Icons.UserPlus }, 
        ];

        const CAROUSEL_FEATURES = [
            { icon: Icons.Feather, text: "Viva a aventura de Slamer." },
            { icon: Icons.Layers, text: "Desbloqueie novos livros vencendo." },
            { icon: Icons.Zap, text: "Torne-se um Guardi√£o Real." },
        ];

        // --- COMPONENTES AUXILIARES ---
        
        const HeartsDisplay = ({ count }) => (
          <div className="flex items-center space-x-1 px-3 py-1 bg-red-50 border border-red-100 rounded-full">
            <Icons.Heart className="w-4 h-4 text-red-500 fill-red-500" />
            <span className="font-bold text-red-700 text-sm">{count}</span>
          </div>
        );

        const Modal = ({ title, children, onClose, color = "blue" }) => (
          <div className="fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-[100] p-4 backdrop-blur-sm animate-in">
            <div className="bg-white p-6 rounded-2xl shadow-2xl w-full max-w-md transform transition-all scale-100">
              <h3 className={`text-xl font-black text-${color}-600 mb-4 uppercase tracking-wide`}>{title}</h3>
              <div className="text-slate-600 mb-6 font-medium">{children}</div>
              <button onClick={onClose} className={`w-full py-3 bg-${color}-500 text-white font-bold rounded-xl hover:bg-${color}-600 transition shadow-lg shadow-${color}-200`}>
                Continuar
              </button>
            </div>
          </div>
        );

        // --- TELAS DE AUTH ---

        const AuthScreen = ({ onLogin, onRegister, existingUsers }) => {
            const [view, setView] = useState('intro'); 
            const [featureIndex, setFeatureIndex] = useState(0);
            const feature = CAROUSEL_FEATURES[featureIndex];
            const [loginData, setLoginData] = useState({ username: '', password: '' });
            const [signupData, setSignupData] = useState({ name: '', username: '', email: '', password: '' });
            const [error, setError] = useState('');

            useEffect(() => {
                const timer = setInterval(() => {
                setFeatureIndex(prev => (prev + 1) % CAROUSEL_FEATURES.length);
                }, 3000);
                return () => clearInterval(timer);
            }, []);

            const handleLoginSubmit = () => {
                if (!loginData.username || !loginData.password) { setError('Preencha tudo.'); return; }
                const user = existingUsers.find(u => u.username.toLowerCase() === loginData.username.toLowerCase() && u.password === loginData.password);
                if (user) { setError(''); onLogin(user); } else { setError('Usu√°rio ou senha incorretos.'); }
            };

            const handleRegisterSubmit = () => {
                if (!signupData.name || !signupData.username || !signupData.password) { setError('Preencha tudo.'); return; }
                onRegister({ name: signupData.name, username: signupData.username, password: signupData.password, email: signupData.email, isAdmin: false });
            };

            const FeatureIcon = feature.icon;

            if (view === 'intro') {
                return (
                    <div className="flex flex-col h-full bg-white p-6 justify-between animate-in">
                        <div className="mt-10 text-center">
                            <div className="bg-yellow-50 w-24 h-24 rounded-3xl flex items-center justify-center mx-auto mb-4 rotate-3 border-4 border-yellow-100 shadow-xl shadow-yellow-100">
                                <Icons.Feather className="w-12 h-12 text-yellow-600" />
                            </div>
                            <h1 className="text-4xl font-black text-slate-800 tracking-tight">{APP_NAME}</h1>
                            <p className="text-slate-500 mt-2 text-lg">Sua jornada por In√°ria come√ßa aqui.</p>
                        </div>
                        <div className="h-32 flex flex-col items-center justify-center text-center p-4 bg-slate-50 rounded-2xl border border-slate-100">
                            <FeatureIcon className="w-8 h-8 text-yellow-500 mb-3" />
                            <p className="font-medium text-slate-700">{feature.text}</p>
                        </div>
                        <div className="space-y-3 mb-8">
                            <button onClick={() => setView('login')} className="w-full py-4 bg-yellow-500 text-white font-bold rounded-2xl shadow-lg shadow-yellow-200 hover:bg-yellow-600 transition active:scale-95">ENTRAR</button>
                            <button onClick={() => setView('signup')} className="w-full py-4 bg-white text-slate-600 font-bold rounded-2xl border-2 border-slate-100 hover:bg-slate-50 transition active:scale-95">CRIAR CONTA</button>
                        </div>
                    </div>
                );
            }

            if (view === 'login') {
                return (
                    <div className="flex flex-col h-full bg-white p-6 slide-in-from-right">
                        <button onClick={() => setView('intro')} className="self-start mb-6 text-slate-400"><Icons.ArrowLeft /></button>
                        <h2 className="text-3xl font-black text-slate-800 mb-2">Login</h2>
                        <div className="space-y-4 flex-grow">
                            <input type="text" placeholder="Usu√°rio (ex: peter)" className="w-full p-4 bg-slate-50 rounded-xl font-bold border" value={loginData.username} onChange={e => setLoginData({...loginData, username: e.target.value})} />
                            <input type="password" placeholder="Senha" className="w-full p-4 bg-slate-50 rounded-xl font-bold border" value={loginData.password} onChange={e => setLoginData({...loginData, password: e.target.value})} />
                            {error && <div className="text-red-500 font-bold text-sm">{error}</div>}
                        </div>
                        <button onClick={handleLoginSubmit} className="w-full py-4 bg-yellow-500 text-white font-bold rounded-2xl shadow-lg">ENTRAR</button>
                    </div>
                );
            }

            return (
                <div className="flex flex-col h-full bg-white p-6 slide-in-from-right">
                    <button onClick={() => setView('intro')} className="self-start mb-6 text-slate-400"><Icons.ArrowLeft /></button>
                    <h2 className="text-3xl font-black text-slate-800 mb-2">Criar Conta</h2>
                    <div className="space-y-3 flex-grow">
                        <input type="text" placeholder="Nome" className="w-full p-4 bg-slate-50 rounded-xl font-bold border" value={signupData.name} onChange={e => setSignupData({...signupData, name: e.target.value})} />
                        <input type="text" placeholder="Usu√°rio" className="w-full p-4 bg-slate-50 rounded-xl font-bold border" value={signupData.username} onChange={e => setSignupData({...signupData, username: e.target.value})} />
                        <input type="password" placeholder="Senha" className="w-full p-4 bg-slate-50 rounded-xl font-bold border" value={signupData.password} onChange={e => setSignupData({...signupData, password: e.target.value})} />
                        {error && <div className="text-red-500 font-bold text-sm">{error}</div>}
                    </div>
                    <button onClick={handleRegisterSubmit} className="w-full py-4 bg-blue-600 text-white font-bold rounded-2xl shadow-lg">REGISTRAR</button>
                </div>
            );
        };

        // --- JOGOS ---

        const QuizGame = ({ onComplete, onMistake }) => {
            const [selected, setSelected] = useState(null);
            const [feedback, setFeedback] = useState(null);
            const handleConfirm = () => {
                if (!selected) return;
                const isCorrect = selected === QUIZ_DATA.correctAnswer;
                setFeedback(isCorrect ? 'correct' : 'wrong');
                if (!isCorrect) onMistake();
                setTimeout(() => { if (isCorrect) onComplete(); else { setSelected(null); setFeedback(null); } }, 1500);
            };
            return (
                <div className="p-6 h-full flex flex-col">
                    <div className="mb-6"><span className="text-xs font-bold text-blue-500 uppercase">Quiz</span><h2 className="text-xl font-bold text-slate-800 mt-2">{QUIZ_DATA.question}</h2></div>
                    <div className="space-y-3 flex-grow">
                        {QUIZ_DATA.options.map((opt, idx) => (
                            <button key={idx} onClick={() => !feedback && setSelected(opt)} className={`w-full p-4 rounded-xl text-left font-bold border-2 transition-all ${feedback === 'correct' && opt === QUIZ_DATA.correctAnswer ? 'bg-green-100 border-green-500 text-green-700' : feedback === 'wrong' && selected === opt ? 'bg-red-100 border-red-500 text-red-700' : selected === opt ? 'bg-blue-50 border-blue-500 text-blue-700' : 'bg-white border-slate-200 text-slate-600'}`}>{opt}</button>
                        ))}
                    </div>
                    <button onClick={handleConfirm} className="w-full py-4 bg-blue-600 text-white font-bold rounded-xl">Confirmar</button>
                </div>
            );
        };

        const MemoryGame = ({ onComplete }) => {
            const [cards, setCards] = useState([]);
            const [flipped, setFlipped] = useState([]);
            const [matched, setMatched] = useState([]);
            useEffect(() => {
                const deck = [...MEMORY_CARDS, ...MEMORY_CARDS].sort(() => Math.random() - 0.5).map((card, index) => ({ ...card, uniqueId: index }));
                setCards(deck);
            }, []);
            const handleCardClick = (id) => {
                if (flipped.length === 2 || flipped.includes(id) || matched.includes(cards.find(c => c.uniqueId === id).id)) return;
                const newFlipped = [...flipped, id];
                setFlipped(newFlipped);
                if (newFlipped.length === 2) {
                    const card1 = cards.find(c => c.uniqueId === newFlipped[0]);
                    const card2 = cards.find(c => c.uniqueId === newFlipped[1]);
                    if (card1.id === card2.id) {
                        setMatched([...matched, card1.id]);
                        setFlipped([]);
                        if (matched.length + 1 === MEMORY_CARDS.length) setTimeout(onComplete, 1000);
                    } else { setTimeout(() => setFlipped([]), 1000); }
                }
            };
            return (
                <div className="p-4 h-full flex flex-col">
                    <h2 className="text-center font-black text-slate-700 mb-4">Encontre os Pares</h2>
                    <div className="grid grid-cols-3 gap-3 flex-grow content-center">
                        {cards.map((card) => {
                            const isFlipped = flipped.includes(card.uniqueId) || matched.includes(card.id);
                            const IconComponent = card.icon;
                            return (
                                <button key={card.uniqueId} onClick={() => handleCardClick(card.uniqueId)} className={`aspect-square rounded-xl flex items-center justify-center transition-all duration-500 transform ${isFlipped ? 'bg-yellow-400 rotate-0' : 'bg-slate-200 rotate-y-180'}`}>
                                    {isFlipped ? <div className="flex flex-col items-center animate-in zoom-in"><IconComponent size={24} className="text-white mb-1" /><span className="text-[8px] font-bold text-yellow-900 uppercase">{card.name}</span></div> : <Icons.HelpCircle className="text-slate-300" />}
                                </button>
                            )
                        })}
                    </div>
                </div>
            );
        };

        const DragDropGame = ({ onComplete }) => {
            const [targets, setTargets] = useState(DRAG_DATA.pairs.map(p => ({ ...p, assigned: null })));
            const [options, setOptions] = useState(DRAG_DATA.sources);
            const [selectedOption, setSelectedOption] = useState(null);
            const handleAssign = (targetId) => {
                if (!selectedOption) return;
                const newTargets = targets.map(t => t.id === targetId ? { ...t, assigned: selectedOption } : t);
                const newOptions = options.filter(o => o.id !== selectedOption.id);
                const oldTarget = targets.find(t => t.id === targetId);
                if (oldTarget.assigned) newOptions.push(oldTarget.assigned);
                setTargets(newTargets); setOptions(newOptions); setSelectedOption(null);
                if (newTargets.every(t => t.assigned && t.assigned.content === t.description)) setTimeout(onComplete, 1000);
            };
            return (
                <div className="p-4 h-full flex flex-col">
                    <h2 className="text-center font-bold text-slate-700 mb-4">Conecte</h2>
                    <div className="space-y-3 flex-grow">
                        {targets.map(t => (
                            <div key={t.id} onClick={() => handleAssign(t.id)} className={`p-4 rounded-xl border-2 border-dashed flex justify-between items-center transition-all ${t.assigned ? 'border-blue-500 bg-blue-50' : 'border-slate-300'}`}>
                                <span className="font-bold text-slate-600">{t.target}</span>
                                <div className={`px-3 py-1 rounded text-xs font-bold ${t.assigned ? 'bg-blue-500 text-white' : 'bg-slate-200 text-slate-400'}`}>{t.assigned ? t.assigned.content : '?'}</div>
                            </div>
                        ))}
                    </div>
                    <div className="flex flex-wrap gap-2 justify-center mt-4 pb-4">
                        {options.map(opt => (
                            <button key={opt.id} onClick={() => setSelectedOption(opt)} className={`px-4 py-2 rounded-full font-bold text-sm border-2 ${selectedOption?.id === opt.id ? 'bg-slate-800 text-white border-slate-800' : 'bg-white text-slate-600 border-slate-200'}`}>{opt.content}</button>
                        ))}
                    </div>
                </div>
            );
        };

        const SpellTyperGame = ({ onComplete }) => {
            const [spellIdx, setSpellIdx] = useState(0);
            const [input, setInput] = useState('');
            const [shake, setShake] = useState(false);
            const handleSubmit = (e) => {
                e.preventDefault();
                if (input.toLowerCase().trim() === SPELL_DATA[spellIdx].spell.toLowerCase().trim()) {
                    setInput('');
                    if (spellIdx + 1 < SPELL_DATA.length) setSpellIdx(prev => prev + 1); else onComplete();
                } else { setShake(true); setTimeout(() => setShake(false), 500); }
            };
            return (
                <div className="p-6 h-full flex flex-col justify-center items-center bg-slate-900 text-white">
                    <div className="mb-8 text-center">
                        <div className="w-16 h-16 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-4"><Icons.Zap className="w-8 h-8 text-white" /></div>
                        <p className="text-blue-300 font-bold uppercase text-xs mb-2">Feiti√ßo {spellIdx + 1}/{SPELL_DATA.length}</p>
                        <h2 className="text-2xl font-black mb-2">{SPELL_DATA[spellIdx].spell}</h2>
                        <p className="text-slate-400 text-sm italic">"{SPELL_DATA[spellIdx].meaning}"</p>
                    </div>
                    <form onSubmit={handleSubmit} className="w-full">
                        <input autoFocus value={input} onChange={e => setInput(e.target.value)} className={`w-full bg-slate-800 border-2 border-slate-700 rounded-xl p-4 text-center font-bold text-lg focus:border-blue-500 focus:outline-none transition-all ${shake ? 'border-red-500 translate-x-2' : ''}`} placeholder="Digite o feiti√ßo..." />
                        <button type="submit" className="w-full mt-4 py-4 bg-blue-600 rounded-xl font-bold">Lan√ßar</button>
                    </form>
                </div>
            );
        };

        const BattleGame = ({ onComplete, onMistake }) => {
            const [enemyHp, setEnemyHp] = useState(BATTLE_DATA.enemyMaxHp);
            const [playerHp, setPlayerHp] = useState(BATTLE_DATA.playerMaxHp);
            const [log, setLog] = useState("Cruhell apareceu!");
            const [turn, setTurn] = useState('player');
            useEffect(() => { if (enemyHp <= 0) setTimeout(onComplete, 1500); if (playerHp <= 0) onMistake(); }, [enemyHp, playerHp]);
            const handleAction = (type) => {
                if (turn !== 'player') return;
                if (type === 'attack') {
                    const dmg = Math.floor(Math.random() * 20) + 10;
                    setEnemyHp(prev => Math.max(0, prev - dmg));
                    setLog(`Voc√™ atacou! -${dmg} HP`);
                    setTurn('enemy');
                    setTimeout(() => {
                        const pDmg = Math.floor(Math.random() * 15) + 5;
                        setPlayerHp(prev => Math.max(0, prev - pDmg));
                        setLog(`Cruhell atacou! -${pDmg} HP`);
                        setTurn('player');
                    }, 1500);
                }
            };
            return (
                <div className="h-full flex flex-col bg-slate-50">
                    <div className="bg-slate-800 p-6 pb-10 rounded-b-3xl text-white text-center relative shadow-xl">
                        <div className="w-20 h-20 bg-red-900 rounded-full mx-auto flex items-center justify-center mb-3 border-4 border-red-700"><Icons.Ghost size={40} /></div>
                        <h3 className="font-black text-xl text-red-100">{BATTLE_DATA.enemyName}</h3>
                        <div className="w-full bg-slate-900 h-3 rounded-full mt-2 overflow-hidden border border-slate-700"><div className="bg-red-500 h-full transition-all duration-500" style={{ width: `${(enemyHp / BATTLE_DATA.enemyMaxHp) * 100}%` }}></div></div>
                    </div>
                    <div className="flex-grow p-6 flex items-center justify-center"><p className="text-center text-slate-600 font-bold italic animate-pulse">{log}</p></div>
                    <div className="p-6 bg-white border-t border-slate-200">
                        <div className="flex justify-between items-center mb-4"><span className="font-bold text-slate-700">Peter</span><span className="font-bold text-green-600">{playerHp} HP</span></div>
                        <button onClick={() => handleAction('attack')} disabled={turn !== 'player'} className="w-full bg-red-100 text-red-600 p-4 rounded-xl font-bold border-2 border-red-200 flex justify-center items-center"><Icons.Flame className="mr-2"/> Atacar</button>
                    </div>
                </div>
            );
        };

        const UnscrambleGame = ({ onComplete }) => {
            const [pieces, setPieces] = useState([...PUZZLE_DATA.scrambled]);
            const [ordered, setOrdered] = useState([]);
            const handleSelect = (piece) => { setPieces(pieces.filter(p => p.id !== piece.id)); setOrdered([...ordered, piece]); };
            const handleReset = () => { setPieces([...PUZZLE_DATA.scrambled]); setOrdered([]); };
            const handleCheck = () => {
                if (ordered.map(p => p.text).join(" ") === PUZZLE_DATA.correctOrder.join(" ")) onComplete(); else alert("Ordem incorreta.");
            };
            return (
                <div className="p-6 h-full flex flex-col bg-[#fffbeb]">
                    <div className="text-center mb-6"><h2 className="text-xl font-black text-amber-800">Restaure o Texto</h2></div>
                    <div className="bg-white border-2 border-amber-200 p-4 rounded-xl min-h-[150px] mb-6 shadow-inner flex flex-wrap content-start gap-2">
                        {ordered.map((p, idx) => <span key={idx} className="bg-amber-100 text-amber-900 px-2 py-1 rounded border border-amber-300 font-serif">{p.text}</span>)}
                    </div>
                    <div className="flex flex-wrap gap-2 justify-center flex-grow content-start">
                        {pieces.map(p => <button key={p.id} onClick={() => handleSelect(p)} className="bg-white text-slate-700 px-4 py-3 rounded-lg shadow-sm border border-slate-200 font-medium">{p.text}</button>)}
                    </div>
                    <div className="flex gap-3 mt-auto"><button onClick={handleReset} className="p-4 bg-slate-200 text-slate-600 rounded-xl font-bold"><Icons.RefreshCw /></button><button onClick={handleCheck} className="flex-grow p-4 bg-amber-500 text-white rounded-xl font-bold">Verificar</button></div>
                </div>
            );
        };

        // --- APP PRINCIPAL ---

        const App = () => {
            const [screen, setScreen] = useState('Auth');
            const [activeTab, setActiveTab] = useState('Home');
            const [currentUser, setCurrentUser] = useState(null);
            const [progress, setProgress] = useState({ currentModuleId: 'm1', completedModules: [] });
            const [currentGame, setCurrentGame] = useState(null);
            const [userHearts, setUserHearts] = useState(5);
            const [showWinModal, setShowWinModal] = useState(false);
            const [users, setUsers] = useState(INITIAL_USERS);

            const handleLogin = (user) => { setCurrentUser(user); setScreen('Home'); };
            const handleRegister = (u) => { setUsers([...users, u]); setCurrentUser(u); setScreen('Home'); };
            const startGame = (module) => { setCurrentGame(module); setScreen('Game'); };

            const handleWin = () => {
                setShowWinModal(true);
                const currIdx = MAP_STRUCTURE.findIndex(m => m.id === currentGame.id);
                const nextModule = MAP_STRUCTURE[currIdx + 1];
                setProgress(prev => ({ ...prev, completedModules: [...prev.completedModules, currentGame.id], currentModuleId: nextModule ? nextModule.id : 'completed' }));
            };
            const handleCloseWin = () => { setShowWinModal(false); setScreen('Map'); };

            const renderGame = () => {
                switch(currentGame?.gameType) {
                    case 'Quiz': return <QuizGame onComplete={handleWin} onMistake={() => setUserHearts(h => h-1)} />;
                    case 'DragAndDrop': return <DragDropGame onComplete={handleWin} />;
                    case 'Memory': return <MemoryGame onComplete={handleWin} />;
                    case 'SpellTyper': return <SpellTyperGame onComplete={handleWin} />;
                    case 'Battle': return <BattleGame onComplete={handleWin} onMistake={() => setUserHearts(h => h-1)} />;
                    case 'Unscramble': return <UnscrambleGame onComplete={handleWin} />;
                    default: return <div>Jogo n√£o encontrado</div>;
                }
            };

            if (screen === 'Auth') {
                return <AuthScreen onLogin={handleLogin} onRegister={handleRegister} existingUsers={users} />;
            }

            if (screen === 'Home') {
                return (
                    <div className="max-w-md mx-auto bg-slate-50 h-screen flex flex-col relative">
                        <div className="bg-white p-6 shadow-sm flex justify-between items-center sticky top-0 z-10">
                            <div><p className="text-xs font-bold text-slate-400 uppercase">Ol√°, {currentUser.name}</p><h2 className="text-xl font-black text-slate-800">{activeTab === 'Home' ? 'Seus Livros' : activeTab === 'Ranking' ? 'Ranking Geral' : activeTab === 'Achievements' ? 'Conquistas' : 'Perfil'}</h2></div>
                            <div className="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 font-bold">{currentUser.name[0]}</div>
                        </div>

                        <div className="flex-grow overflow-y-auto p-6 pb-24">
                            {activeTab === 'Home' && (
                                <div className="space-y-6 animate-in">
                                    {MOCK_BOOKS.map(book => {
                                        const BookIcon = book.icon;
                                        return (
                                            <div key={book.id} onClick={() => setScreen('Map')} className="bg-white p-4 rounded-2xl border-2 border-yellow-400 shadow-xl shadow-yellow-100 cursor-pointer transform transition hover:scale-[1.02]">
                                                <div className="flex items-center space-x-4">
                                                    <div className="w-16 h-16 bg-yellow-500 rounded-xl flex items-center justify-center text-white shadow-lg"><BookIcon size={32} /></div>
                                                    <div>
                                                        <h3 className="font-bold text-lg text-slate-800">{book.title}</h3>
                                                        <div className="flex items-center space-x-2 mt-1"><span className="text-xs font-bold bg-slate-100 px-2 py-1 rounded text-slate-500">6 Fases</span><span className="text-xs font-bold text-yellow-600">{Math.round((progress.completedModules.length / MAP_STRUCTURE.length) * 100)}% Completo</span></div>
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                    <div className="mt-8 p-6 bg-blue-600 rounded-2xl text-white shadow-lg shadow-blue-200">
                                        <div className="flex items-center space-x-2 mb-2"><Icons.Award className="text-blue-200" /><span className="font-bold uppercase text-xs text-blue-200">Pr√≥xima Conquista</span></div>
                                        <h3 className="font-bold text-lg">Guardi√£o de In√°ria</h3>
                                        <p className="text-sm text-blue-100 mt-1 opacity-80">Complete todos os 6 mini-games.</p>
                                    </div>
                                </div>
                            )}
                            {activeTab === 'Ranking' && (
                                <div className="space-y-3">
                                    {MOCK_RANKING.map((r, i) => (
                                        <div key={i} className={`p-4 rounded-xl flex items-center justify-between ${r.isSelf ? 'bg-blue-100 border-blue-300' : 'bg-white border-slate-200'} border shadow-sm`}>
                                            <div className="flex items-center space-x-3">
                                                <span className={`font-black text-lg w-6 ${i < 3 ? 'text-yellow-500' : 'text-slate-400'}`}>{r.rank}</span>
                                                <span className="font-bold text-slate-700">{r.name}</span>
                                            </div>
                                            <span className="text-sm font-bold text-blue-600">{r.xp} XP</span>
                                        </div>
                                    ))}
                                </div>
                            )}
                            {activeTab === 'Achievements' && (
                                <div className="space-y-3">
                                    {MOCK_ACHIEVEMENTS.map(ach => {
                                        const AchIcon = ach.icon;
                                        return (
                                            <div key={ach.id} className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm flex items-center space-x-3">
                                                <div className={`p-2 rounded-lg ${ach.completed ? 'bg-green-100 text-green-600' : 'bg-slate-100 text-slate-400'}`}><AchIcon size={20}/></div>
                                                <div><p className="font-bold text-slate-800">{ach.title}</p><p className="text-xs text-slate-400">{ach.description}</p></div>
                                            </div>
                                        );
                                    })}
                                </div>
                            )}
                            {activeTab === 'Profile' && (
                                <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 text-center">
                                    <div className="w-24 h-24 bg-slate-100 rounded-full mx-auto mb-4 flex items-center justify-center text-4xl">üßô‚Äç‚ôÇÔ∏è</div>
                                    <h2 className="text-2xl font-black text-slate-800">{currentUser.name}</h2>
                                    <p className="text-slate-500">@{currentUser.username}</p>
                                    <button className="mt-6 text-red-500 font-bold" onClick={() => setScreen('Auth')}>Sair</button>
                                </div>
                            )}
                        </div>

                        {/* MENU INFERIOR */}
                        <div className="absolute bottom-0 w-full bg-white border-t border-slate-200 p-2 flex justify-around items-end pb-4 shadow-[0_-5px_20px_rgba(0,0,0,0.05)] z-40">
                            <button onClick={() => setActiveTab('Home')} className={`flex flex-col items-center p-2 rounded-xl transition ${activeTab === 'Home' ? 'text-blue-500 bg-blue-50' : 'text-slate-400'}`}><Icons.Home size={24} strokeWidth={activeTab === 'Home' ? 3 : 2} /><span className="text-[10px] font-bold mt-1">In√≠cio</span></button>
                            <button onClick={() => setActiveTab('Ranking')} className={`flex flex-col items-center p-2 rounded-xl transition ${activeTab === 'Ranking' ? 'text-blue-500 bg-blue-50' : 'text-slate-400'}`}><Icons.Award size={24} strokeWidth={activeTab === 'Ranking' ? 3 : 2} /><span className="text-[10px] font-bold mt-1">Ranking</span></button>
                            <div className="relative -top-5">
                                <button className="bg-slate-300 text-white p-4 rounded-full shadow-lg border-4 border-white flex items-center justify-center"><Icons.Lock size={28} strokeWidth={3} /></button>
                            </div>
                            <button onClick={() => setActiveTab('Achievements')} className={`flex flex-col items-center p-2 rounded-xl transition ${activeTab === 'Achievements' ? 'text-blue-500 bg-blue-50' : 'text-slate-400'}`}><Icons.Trophy size={24} strokeWidth={activeTab === 'Achievements' ? 3 : 2} /><span className="text-[10px] font-bold mt-1">Trof√©us</span></button>
                            <button onClick={() => setActiveTab('Profile')} className={`flex flex-col items-center p-2 rounded-xl transition ${activeTab === 'Profile' ? 'text-blue-500 bg-blue-50' : 'text-slate-400'}`}><Icons.User size={24} strokeWidth={activeTab === 'Profile' ? 3 : 2} /><span className="text-[10px] font-bold mt-1">Perfil</span></button>
                        </div>
                    </div>
                );
            }

            if (screen === 'Map') {
                return (
                    <div className="max-w-md mx-auto bg-slate-100 h-screen flex flex-col">
                        <div className="bg-white p-4 sticky top-0 z-10 shadow-sm flex items-center justify-between">
                            <button onClick={() => setScreen('Home')}><Icons.ArrowLeft className="text-slate-400" /></button>
                            <span className="font-bold text-slate-700">Mapa da Jornada</span>
                            <Icons.Settings className="text-slate-400" />
                        </div>
                        <div className="flex-grow overflow-y-auto p-6 pb-24 relative">
                            <div className="absolute left-1/2 top-10 bottom-10 w-1 bg-slate-300 -translate-x-1/2 rounded-full" />
                            <div className="space-y-10 relative z-10">
                                {MAP_STRUCTURE.map((mod, idx) => {
                                    const isCompleted = progress.completedModules.includes(mod.id);
                                    const isCurrent = progress.currentModuleId === mod.id;
                                    const isLocked = !isCompleted && !isCurrent;
                                    return (
                                        <div key={mod.id} className={`flex flex-col items-center ${idx % 2 === 0 ? 'mr-auto pr-12 self-start' : 'ml-auto pl-12 self-end'} w-1/2 relative`}>
                                            <div className={`absolute top-8 h-1 w-12 bg-slate-300 ${idx % 2 === 0 ? 'right-0' : 'left-0'}`} />
                                            <button disabled={isLocked} onClick={() => startGame(mod)} className={`w-16 h-16 rounded-full border-4 shadow-lg flex items-center justify-center transition-transform active:scale-95 z-20 ${isCompleted ? 'bg-yellow-400 border-yellow-500 text-white' : isCurrent ? 'bg-blue-500 border-blue-600 text-white ring-4 ring-blue-200' : 'bg-slate-200 border-slate-300 text-slate-400'}`}>
                                                {isCompleted ? <Icons.Check /> : isLocked ? <Icons.Lock size={20} /> : <Icons.Star fill="currentColor" />}
                                            </button>
                                            <div className="mt-2 bg-white p-2 rounded-lg shadow-sm text-center min-w-[120px]"><p className="text-[10px] font-bold text-slate-400 uppercase mb-1">Fase {idx + 1}</p><p className="text-xs font-bold text-slate-700 leading-tight">{mod.title}</p></div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    </div>
                );
            }

            if (screen === 'Game') {
                return (
                    <div className="max-w-md mx-auto bg-white h-screen flex flex-col">
                        <div className="p-4 border-b flex justify-between items-center bg-slate-50">
                            <button onClick={() => setScreen('Map')}><Icons.X className="text-slate-400" /></button>
                            <span className="font-bold text-slate-700">{currentGame.title}</span>
                            <HeartsDisplay count={userHearts} />
                        </div>
                        <div className="flex-grow overflow-hidden relative">{renderGame()}</div>
                        {showWinModal && (
                            <Modal title="Fase Conclu√≠da!" onClose={handleCloseWin} color="green">
                                <div className="text-center">
                                    <div className="bg-green-100 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4"><Icons.Trophy className="w-10 h-10 text-green-600" /></div>
                                    <p>Voc√™ dominou esta parte da hist√≥ria!</p><p className="text-sm mt-2 text-slate-400">+150 XP</p>
                                </div>
                            </Modal>
                        )}
                    </div>
                );
            }

            return <div>Carregando...</div>;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
